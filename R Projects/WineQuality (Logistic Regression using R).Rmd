---
title: "WineQuality (Logistic Regression using R)"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

The objective of this assignment is to learn how to explore, prepare, and analyze a Logistic Regression Model.
This dataset is about the properties of Wine and its quality. The objective is to predict the Quality of the wine using its contents such as alcohol, density, and pH level. We will also use statistical analysis to see what attributes are significant/insignificant to the model(s).

Importing Data:
```{r}
wine <- read.csv("/Users/azamrahman/Desktop/CMTH 642 (R)/Assignment 2/winequality-white.csv", header = TRUE, sep =";")
```

# Question 1: Check the datatypes of the attributes.
```{r}
sapply(wine, class)
# All variables are numeric except for quality, which is an integer.
```

# Question 2: Are there any missing values in the dataset?
```{r}
sum(is.na(wine))
# There are no missing values in this dataset.
```

# Question 3: What is the correlation between the attributes other than Quality?
```{r}
library(corrplot)
winecor <- data.frame(wine$fixed.acidity, wine$volatile.acidity, wine$citric.acid, wine$residual.sugar, wine$chlorides, wine$free.sulfur.dioxide, wine$total.sulfur.dioxide, wine$density, wine$pH, wine$sulphates, wine$alcohol) 

corrplot(cor(winecor), type = "upper", order = "hclust", tl.col = "black", 
         tl.srt = 45.)
# Couple of things to note from this: density vs. alcohol has a strong negative correlation
# Sugar and Density has a strong positive correlation
```

# Question 4: Graph the frequency distribution of wine quality by using Quality.
```{r}
hist(wine$quality)
# We can see the most frequent wine quality is rated at 6, followed by 5.
```

# Question 5: Reduce the levels of rating for quality to two levels as Pass and Fail. Assign the levels of 3, 4 and 5 to level Fail; and 6, 7, 8 and 9 to level Pass.
```{r}
wine$quality[wine$quality == 3 | wine$quality == 4 | wine$quality == 5 ] = "Fail"
wine$quality[wine$quality == 6 | wine$quality == 7 | wine$quality == 8 | wine$quality == 9 ] = "Pass"
wine$quality <- as.factor(wine$quality)
```

# Question 6: Normalize the data set.
```{r}
norm <- function(x){
  return ((x - min(x)) / (max(x) - min(x)))
}

# Pass = 1, Fail = 0:
wine$quality <- ifelse(wine$quality == "Pass",1,0)

winenorm <- data.frame(sapply(wine, norm))
```

# Question 7: Divide the dataset to training and test sets.
```{r}
# Splitting data (70% Train, 30% Test)
train_index <- sample(1:nrow(winenorm), 0.7 * nrow(winenorm))
train.set <- winenorm[train_index,]
test.set <- winenorm[-train_index,]
```

# Question 8: Use the Logistic Regression algorithm to predict the quality of wine using its attributes.
```{r}
# Create Logistic Regression:
model <- glm(formula = quality ~., family = "binomial", data = winenorm) 

summary(model)

# Predict model:
pdata <- predict(model, test.set, type = "response")

predicted_class <- ifelse(pdata > 0.5, 1, 0)
```

With a significance level of 5%, there are a couple of variables that are not significant to the model as it equals zero. fixed.acidity, citric.acid, chlorides, and total.sulfur.dioxide, all contain p values above 0.05 and therefore we do not reject the null hypothesis for these variables to show that the variables are insignificant to the model.

# Question 9: Display the confusion matrix to evaluate the model performance.
```{r}
ConfusionMatrix <- table(actual = test.set$quality, predicted = predicted_class)

ConfusionMatrix
```

# Question 10: Evaluate the model performance by computing Accuracy, Sensitivity and Specificity. 
```{r}
library(caret)

# Accuracy: (relatively a decent accuracy from this model)
Accuracy <-  sum(diag(ConfusionMatrix))/nrow(test.set)
Accuracy

# Sensitivity: (relatively an okay sensitivity as it effectively predicts wine quality of Pass)
Sensitivity <- sensitivity(ConfusionMatrix)
Sensitivity

# Specificity: (relatively a decent specificity as it effectively predicts wine quality of Fail)
Specificity <- specificity(ConfusionMatrix)
Specificity
```

Extra Learning:

Let's create a model with only the significant variables to see how it would hold up against the complete model:
```{r}
# Create Selected Logistic Regression:
modelselected <- glm(formula = quality ~ volatile.acidity + residual.sugar + free.sulfur.dioxide + density + pH + sulphates + alcohol, family = "binomial", data = winenorm) 

summary(modelselected)

# Predict model:
pdata <- predict(modelselected, test.set, type = "response")

predicted_class_sel <- ifelse(pdata > 0.5, 1, 0)
```
```{r}
ConfusionMatrixSel <- table(actual = test.set$quality, predicted = predicted_class_sel)

ConfusionMatrixSel
```

```{r}

# Accuracy: (relatively a decent accuracy from this model)
Accuracy <-  sum(diag(ConfusionMatrixSel))/nrow(test.set)
Accuracy

# Sensitivity: (relatively an okay sensitivity as it effectively predicts wine quality of Pass)
Sensitivity <- sensitivity(ConfusionMatrixSel)
Sensitivity

# Specificity: (relatively a decent specificity as it effectively predicts wine quality of Fail)
Specificity <- specificity(ConfusionMatrixSel)
Specificity
```

With the Selected model, we see a very slight increase in performance measure which may indicate that it may not be necessary to select attributes since it makes an insignificant amount of difference.